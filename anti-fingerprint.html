<!DOCTYPE html>
<html lang="en" class="">
<head>
  <title>instant-markdown-d</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="Content-Language" content="en">
  <link rel="stylesheet" type="text/css" href="./css/github-syntax-highlight.css">
  <link rel="stylesheet" type="text/css" href="./css/github-markdown.css">
  <link rel="stylesheet" type="text/css" href="./css/mjpage-html.css">
  <style>
    .markdown-body {
      min-width: 200px;
      margin: 0 auto;
      padding: 30px;
    }
    #con-error {
      position: fixed;
      top: 0px;
      right: 0px;
      padding: 5px;
      background: white;
      color: red;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="item row1"></div>
    <div class="item row1"></div>
    <div class="item row2"></div>
    <div class="item row2">
      <div class="repository-with-sidebar repo-container new-discussion-timeline with-full-navigation">
         <div id="js-repo-pjax-container" class="repository-content context-loader-container">
           <div id="readme" class="boxed-group flush clearfix announce instapaper_body md">
             <article class="markdown-body"><h3>设备指纹对抗</h3>
<h4>修改 UA 信息（模拟浏览器信息）</h4>
<img src="https://user-images.githubusercontent.com/1673877/117770695-cf0c5680-b267-11eb-865e-1531c923803c.png" width="400">
<h4>篡改 WebGL 指纹</h4>
<ul>
<li><a href="https://mybrowseraddon.com/webgl-defender.html">https://mybrowseraddon.com/webgl-defender.html</a></li>
</ul>
<p>安装上面的插件会随机生成不同的 WebGL 指纹。</p>
<p>测试地址：</p>
<ul>
<li><a href="https://browserleaks.com/webgl">https://browserleaks.com/webgl</a></li>
<li><a href="https://webbrowsertools.com/webgl-fingerprint/">https://webbrowsertools.com/webgl-fingerprint/</a></li>
</ul>
<h4>篡改 font 指纹</h4>
<ul>
<li><a href="https://mybrowseraddon.com/font-defender.html">https://mybrowseraddon.com/font-defender.html</a></li>
</ul>
<p>安装上面的插件会随机生成不同的 font 指纹。</p>
<ul>
<li>测试地址：
<ul>
<li><a href="https://browserleaks.com/fonts">https://browserleaks.com/fonts</a></li>
<li><a href="https://webbrowsertools.com/font-fingerprint/">https://webbrowsertools.com/font-fingerprint/</a></li>
</ul>
</li>
</ul>
<h4>篡改 canvas 指纹</h4>
<ul>
<li>随机变更模拟 canvas 指纹的插件
<ul>
<li><a href="https://chrome.google.com/webstore/detail/canvas-blocker-fingerprin/nomnklagbgmgghhjidfhnoelnjfndfpd">https://chrome.google.com/webstore/detail/canvas-blocker-fingerprin/nomnklagbgmgghhjidfhnoelnjfndfpd</a></li>
<li><a href="https://chrome.google.com/webstore/detail/canvas-fingerprint-defend/lanfdkkpgfjfdikkncbnojekcppdebfp">https://chrome.google.com/webstore/detail/canvas-fingerprint-defend/lanfdkkpgfjfdikkncbnojekcppdebfp</a></li>
</ul>
</li>
<li>固定模拟 canvas 指纹的插件
<ul>
<li><a href="https://chrome.google.com/webstore/detail/canvas-viewedit-google-im/bfncneeboblpajkpienladgdmfdkpefg">https://chrome.google.com/webstore/detail/canvas-viewedit-google-im/bfncneeboblpajkpienladgdmfdkpefg</a></li>
</ul>
</li>
</ul>
<h4><code>Accept-Language</code>修改</h4>
<p>通过插件配置：<a href="https://github.com/FirefoxBar/HeaderEditor">https://github.com/FirefoxBar/HeaderEditor</a></p>
<p>配置内容：</p>
<img src="https://user-images.githubusercontent.com/1673877/117785490-3978c300-b277-11eb-863d-80e10cb14d30.png" width="400">
<p>或者通过<code>IMPORT</code>导入如下 JSON 配置：</p>
<pre><code class="language-json">{
	<span class="hljs-attr">"request"</span>: [],
	<span class="hljs-attr">"sendHeader"</span>: [
		{
			<span class="hljs-attr">"enable"</span>: <span class="hljs-literal">true</span>,
			<span class="hljs-attr">"name"</span>: <span class="hljs-string">"Accept-Language Fake"</span>,
			<span class="hljs-attr">"ruleType"</span>: <span class="hljs-string">"modifySendHeader"</span>,
			<span class="hljs-attr">"matchType"</span>: <span class="hljs-string">"all"</span>,
			<span class="hljs-attr">"pattern"</span>: <span class="hljs-string">""</span>,
			<span class="hljs-attr">"exclude"</span>: <span class="hljs-string">""</span>,
			<span class="hljs-attr">"group"</span>: <span class="hljs-string">"anti-fingerprinting"</span>,
			<span class="hljs-attr">"isFunction"</span>: <span class="hljs-literal">false</span>,
			<span class="hljs-attr">"action"</span>: {
				<span class="hljs-attr">"name"</span>: <span class="hljs-string">"accept-language"</span>,
				<span class="hljs-attr">"value"</span>: <span class="hljs-string">"en;q=0.9, cn;q=0.6"</span>
			}
		},
		{
			<span class="hljs-attr">"enable"</span>: <span class="hljs-literal">true</span>,
			<span class="hljs-attr">"name"</span>: <span class="hljs-string">"Custom Header"</span>,
			<span class="hljs-attr">"ruleType"</span>: <span class="hljs-string">"modifySendHeader"</span>,
			<span class="hljs-attr">"matchType"</span>: <span class="hljs-string">"all"</span>,
			<span class="hljs-attr">"pattern"</span>: <span class="hljs-string">""</span>,
			<span class="hljs-attr">"exclude"</span>: <span class="hljs-string">""</span>,
			<span class="hljs-attr">"group"</span>: <span class="hljs-string">"anti-fingerprinting"</span>,
			<span class="hljs-attr">"isFunction"</span>: <span class="hljs-literal">false</span>,
			<span class="hljs-attr">"action"</span>: {
				<span class="hljs-attr">"name"</span>: <span class="hljs-string">"x-request-from"</span>,
				<span class="hljs-attr">"value"</span>: <span class="hljs-string">"NoScripter"</span>
			}
		}
	],
	<span class="hljs-attr">"receiveHeader"</span>: [],
	<span class="hljs-attr">"receiveBody"</span>: []
}
</code></pre>
<h4>篡改<code>screen</code>信息</h4>
<pre><code class="language-javascript"><span class="hljs-comment">// Change the screen resolution</span>
<span class="hljs-keyword">var</span> height = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">900</span>) + <span class="hljs-number">700</span>;
<span class="hljs-keyword">var</span> width = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">800</span>) + <span class="hljs-number">700</span>;
<span class="hljs-keyword">var</span> availHeight = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">800</span>) + <span class="hljs-number">600</span>;  
screen = <span class="hljs-keyword">new</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">this</span>.width = width; <span class="hljs-keyword">this</span>.height = height; <span class="hljs-keyword">this</span>.colorDepth = <span class="hljs-number">24</span>; <span class="hljs-keyword">this</span>.availHeight=availHeight}
</code></pre>
<p>获取设备指纹前先在控制台执行以上代码。</p>
<h4>篡改<code>timezone</code>信息</h4>
<pre><code class="language-javascript"><span class="hljs-meta">'use strict'</span>;

<span class="hljs-keyword">const</span> prefs = <span class="hljs-string">`
  Date.prefs = Date.prefs || [
    'Etc/GMT', 0, new Date().getTimezoneOffset(), 'London Standard Time'
  ];
  try { // get preferences for subframes synchronously
    Date.prefs = window.parent.Date.prefs;
  }
  catch (e) {}
`</span>;

<span class="hljs-keyword">const</span> intl = <span class="hljs-string">`
  const ODateTimeFormat = Intl.DateTimeFormat;
  Intl.DateTimeFormat = function(locales, options = {}) {
    Object.assign(options, {
      timeZone: Date.prefs[0]
    });
    return ODateTimeFormat(locales, options);
  };
  Intl.DateTimeFormat.prototype = Object.create(ODateTimeFormat.prototype);
  Intl.DateTimeFormat.supportedLocalesOf = ODateTimeFormat.supportedLocalesOf;
`</span>;

<span class="hljs-keyword">const</span> shiftedDate = <span class="hljs-string">`
  const clean = str =&gt; {
    const toGMT = offset =&gt; {
      const z = n =&gt; (n &lt; 10 ? '0' : '') + n;
      const sign = offset &lt;= 0 ? '+' : '-';
      offset = Math.abs(offset);
      return sign + z(offset / 60 | 0) + z(offset % 60);
    };
    str = str.replace(/([T\\(])[\\+-]\\d+/g, '$1' + toGMT(Date.prefs[1]));
    if (str.indexOf(' (') !== -1) {
      str = str.split(' (')[0] + ' (' + Date.prefs[3] + ')';
    }
    return str;
  }

  const ODate = Date;
  const {
    getTime, getDate, getDay, getFullYear, getHours, getMilliseconds, getMinutes, getMonth, getSeconds, getYear,
    toDateString, toLocaleString, toString, toTimeString, toLocaleTimeString, toLocaleDateString,
    setYear, setHours, setTime, setFullYear, setMilliseconds, setMinutes, setMonth, setSeconds, setDate,
    setUTCDate, setUTCFullYear, setUTCHours, setUTCMilliseconds, setUTCMinutes, setUTCMonth, setUTCSeconds
  } = ODate.prototype;
  class ShiftedDate extends ODate {
    constructor(...args) {
      super(...args);
      this.nd = new ODate(
        getTime.apply(this) + (Date.prefs[2] - Date.prefs[1]) * 60 * 1000
      );
    }
    // get
    toLocaleString(...args) {
      return toLocaleString.apply(this.nd, args);
    }
    toLocaleTimeString(...args) {
      return toLocaleTimeString.apply(this.nd, args);
    }
    toLocaleDateString(...args) {
      return toLocaleDateString.apply(this.nd, args);
    }
    toDateString(...args) {
      return toDateString.apply(this.nd, args);
    }
    getDate(...args) {
      return getDate.apply(this.nd, args);
    }
    getDay(...args) {
      return getDay.apply(this.nd, args);
    }
    getFullYear(...args) {
      return getFullYear.apply(this.nd, args);
    }
    getHours(...args) {
      return getHours.apply(this.nd, args);
    }
    getMilliseconds(...args) {
      return getMilliseconds.apply(this.nd, args);
    }
    getMinutes(...args) {
      return getMinutes.apply(this.nd, args);
    }
    getMonth(...args) {
      return getMonth.apply(this.nd, args);
    }
    getSeconds(...args) {
      return getSeconds.apply(this.nd, args);
    }
    getYear(...args) {
      return getYear.apply(this.nd, args);
    }
    // set
    setHours(...args) {
      const a = getTime.call(this.nd);
      const b = setHours.apply(this.nd, args);
      setTime.call(this, getTime.call(this) + b - a);
      return b;
    }
    setFullYear(...args) {
      const a = getTime.call(this.nd);
      const b = setFullYear.apply(this.nd, args);
      setTime.call(this, getTime.call(this) + b - a);
      return b;
    }
    setMilliseconds(...args) {
      const a = getTime.call(this.nd);
      const b = setMilliseconds.apply(this.nd, args);
      setTime.call(this, getTime.call(this) + b - a);
      return b;
    }
    setMinutes(...args) {
      const a = getTime.call(this.nd);
      const b = setMinutes.apply(this.nd, args);
      setTime.call(this, getTime.call(this) + b - a);
      return b;
    }
    setMonth(...args) {
      const a = getTime.call(this.nd);
      const b = setMonth.apply(this.nd, args);
      setTime.call(this, getTime.call(this) + b - a);
      return b;
    }
    setSeconds(...args) {
      const a = getTime.call(this.nd);
      const b = setSeconds.apply(this.nd, args);
      setTime.call(this, getTime.call(this) + b - a);
      return b;
    }
    setDate(...args) {
      const a = getTime.call(this.nd);
      const b = setDate.apply(this.nd, args);
      setTime.call(this, getTime.call(this) + b - a);
      return b;
    }
    setYear(...args) {
      const a = getTime.call(this.nd);
      const b = setYear.apply(this.nd, args);
      setTime.call(this, getTime.call(this) + b - a);
      return b;
    }
    setTime(...args) {
      const a = getTime.call(this);
      const b = setTime.apply(this, args);
      setTime.call(this.nd, getTime.call(this.nd) + b - a);
      return b;
    }
    setUTCDate(...args) {
      const a = getTime.call(this);
      const b = setUTCDate.apply(this, args);
      setTime.call(this.nd, getTime.call(this.nd) + b - a);
      return b;
    }
    setUTCFullYear(...args) {
      const a = getTime.call(this);
      const b = setUTCFullYear.apply(this, args);
      setTime.call(this.nd, getTime.call(this.nd) + b - a);
      return b;
    }
    setUTCHours(...args) {
      const a = getTime.call(this);
      const b = setUTCHours.apply(this, args);
      setTime.call(this.nd, getTime.call(this.nd) + b - a);
      return b;
    }
    setUTCMilliseconds(...args) {
      const a = getTime.call(this);
      const b = setUTCMilliseconds.apply(this, args);
      setTime.call(this.nd, getTime.call(this.nd) + b - a);
      return b;
    }
    setUTCMinutes(...args) {
      const a = getTime.call(this);
      const b = setUTCMinutes.apply(this, args);
      setTime.call(this.nd, getTime.call(this.nd) + b - a);
      return b;
    }
    setUTCMonth(...args) {
      const a = getTime.call(this);
      const b = setUTCMonth.apply(this, args);
      setTime.call(this.nd, getTime.call(this.nd) + b - a);
      return b;
    }
    setUTCSeconds(...args) {
      const a = getTime.call(this);
      const b = setUTCSeconds.apply(this, args);
      setTime.call(this.nd, getTime.call(this.nd) + b - a);
      return b;
    }
    // toString
    toString(...args) {
      return clean(toString.apply(this.nd, args));
    }
    toTimeString(...args) {
      return clean(toTimeString.apply(this.nd, args));
    }
    // offset
    getTimezoneOffset() {
      return Date.prefs[1];
    }
  }
`</span>;

<span class="hljs-keyword">const</span> script = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'script'</span>);
script.textContent = <span class="hljs-string">`{
  <span class="hljs-subst">${prefs}</span>
  <span class="hljs-subst">${intl}</span>
  <span class="hljs-subst">${shiftedDate}</span>
  Date = ShiftedDate;
}`</span>;
<span class="hljs-built_in">document</span>.documentElement.appendChild(script);
script.remove();
</code></pre>
<p>使用方式同上。</p>
<blockquote>
<p>注意：时区信息还可以通过访问的 IP 地址来得到，这种情况如果用户是通过代理来访问，还需要结合代理信息做判断。</p>
</blockquote>
<h4>篡改电池相关信息</h4>
<pre><code class="language-javascript"><span class="hljs-keyword">var</span> bat = navigator.getBattery;
navigator.getBattery = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">window</span>._policy = <span class="hljs-literal">true</span>;
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params">battery, resolve</span>) </span>{
        <span class="hljs-comment">// Proxy object is used to define custom behavior for fundamental operations</span>
        <span class="hljs-keyword">var</span> filtered = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Proxy</span>(battery, {
            <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">target, name</span>) </span>{
                <span class="hljs-comment">// filter whatever we want</span>
                <span class="hljs-keyword">if</span> (name == <span class="hljs-string">"level"</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name == <span class="hljs-string">"charging"</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name == <span class="hljs-string">"chargingTime"</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name == <span class="hljs-string">"dischargingTime"</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> target[name];
            }
        });
        <span class="hljs-comment">// Returns the promise object </span>
        resolve(filtered);
    }

    <span class="hljs-keyword">var</span> real_p = bat.apply(navigator);
    <span class="hljs-comment">// Each promise has success handler and error handler</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) </span>{
        real_p.then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">battery</span>) </span>{
            filter(battery, resolve);
        });
    });
};
</code></pre>
<p>使用方式同上。</p>
<h4>篡改其他信息</h4>
<pre><code class="language-javascript">(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-string">"use strict"</span>;

  <span class="hljs-keyword">const</span> originalUserAgent = <span class="hljs-built_in">window</span>.navigator.userAgent;
  <span class="hljs-keyword">const</span> fakeUserAgent = originalUserAgent.replace(
    <span class="hljs-regexp">/\(.*?(?=(; rv:[^\)]+)?\))/</span>,
    <span class="hljs-string">"(Windows NT 10.0; Win64; x64"</span>
  );
  <span class="hljs-keyword">const</span> fakeVersion = fakeUserAgent.substr(<span class="hljs-number">8</span>);

  <span class="hljs-comment">// 篡改系统信息</span>
  <span class="hljs-built_in">window</span>.navigator.__defineGetter__(<span class="hljs-string">"appVersion"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> fakeVersion;
  });

  <span class="hljs-comment">// 篡改系统语言信息</span>
  <span class="hljs-built_in">window</span>.navigator.__defineGetter__(<span class="hljs-string">"language"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">"en-US"</span>;
  });

  <span class="hljs-comment">// 篡改系统支持的语言信息</span>
  <span class="hljs-built_in">window</span>.navigator.__defineGetter__(<span class="hljs-string">"languages"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> [<span class="hljs-string">"en-US"</span>, <span class="hljs-string">"en"</span>];
  });

  <span class="hljs-comment">// 篡改系统支持的 MIME 信息</span>
  <span class="hljs-built_in">window</span>.navigator.__defineGetter__(<span class="hljs-string">"mimeTypes"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">length</span>: <span class="hljs-number">0</span> };
  });

  <span class="hljs-comment">// 篡改系统支持的 cpu 信息</span>
  <span class="hljs-built_in">window</span>.navigator.__defineGetter__(<span class="hljs-string">"oscpu"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
  });

  <span class="hljs-comment">// 篡改系统平台信息</span>
  <span class="hljs-built_in">window</span>.navigator.__defineGetter__(<span class="hljs-string">"platform"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Win32"</span>;
  });

  <span class="hljs-comment">// 篡改系统插件列表信息</span>
  <span class="hljs-built_in">window</span>.navigator.__defineGetter__(<span class="hljs-string">"plugins"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">length</span>: <span class="hljs-number">0</span> };
  });

  <span class="hljs-comment">// 篡改 UA 信息</span>
  <span class="hljs-built_in">window</span>.navigator.__defineGetter__(<span class="hljs-string">"userAgent"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> fakeUserAgent;
  });

  <span class="hljs-comment">// 篡改 CPU 信息</span>
  <span class="hljs-built_in">window</span>.navigator.__defineGetter__(<span class="hljs-string">"cpuClass"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Intel"</span>;
  });
})();
</code></pre>
<h4>篡改 cookie 信息</h4>
<pre><code class="language-javascript"><span class="hljs-comment">// 篡改 cookie 信息</span>
<span class="hljs-built_in">window</span>.navigator.__defineGetter__(<span class="hljs-string">"cookieEnabled"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
});
</code></pre>
</article>
           </div>
         </div>
       </div>
    </div>
    <div class="item row2"></div>
    <div class="item row3"></div>
    <div class="item row3"></div>
    <div class="item row3"></div>
  </div>
  <div id="con-error" style="display:none">Live preview is unavailable</div>
</body>
</html>
